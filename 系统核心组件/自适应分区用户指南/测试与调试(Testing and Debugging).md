# 测试与调试(Testing and Debugging)

自适应分区通过在系统中提供一个"紧急门"使在开发或者部署期间调试嵌入式系统更容易。只需创建一个可运行诊断工具的分区，如果你不需要使用分区，现成调取器可以将它的预算分配给其他分区。这使您可以访问系统而不会影响其性能。



## 检测内核跟踪事件

被检测的内核会发送跟踪事件，当如下情形发生时

- 当一个调度分区预算改变时(包括分区刚被创建)
- 当一个调度分区名称改变时(例如当分区被创建时)
- 当一个线程以宽模式运行，这些事件包括分区ID并指示该线程是否以关键线程运行
- 当一个调度分区破产(指预算耗尽?)



## 使用IDE追踪事件

你可以并应该使用IDE中的系统分析器工具来检测你的系统延迟。

更多关于使用这个工具和IDE的信息，请查看IDE用户指南章节



## 使用其他方式

测试使用线程调度程序的系统的最简单方法是通过命令行。

确保在满负载状态下测试你的系统，因为这是问题可能发生的地方。

创建一个循环永远消耗资源的程序，在每个分区运行它，然后执行如下操作:

- 注意破产，您应该将其视为编程错误。你可以使用**SchedCtl()**携带**SCHED_APS_BNKR_\***标志来控制一个分区耗尽其预算时会发生什么。范围可以从阻止分区的线程运行到重新启动系统。更多信息，请查看QNX Neutrino C Library Reference
- 确保系统的所有延迟都是可接受的。
- 使用**aps**命令来修改你分区的预算。新预算在下一个平均窗口开始处生效。由于窗口大小通常是100ms，因此你可以快速尝试多种不同的预算组合。



## 紧急访问系统

你可以使用自适应分区通过提供紧急访问来更轻松地调试嵌入式系统：

- 在开发时，创建一个分区并启动**io-pkt**与**qconn**。然后，如果一个失控的进程阻碍了系统，你可以使用IDE来调试和查询系统。
- 在部署时，创建一个分区并启动**io-pkt**与**inetd**。如果你遇到一个问题，你可以使用**telnet**进入系统。

在这两种情况中，如果你不使用该分区，线程调度器将其预算分配给其他分区。这使您可以访问系统而不会影响其性能。

一种不同的方式是创建一个独立分区来运行所有有问题的应用；如果它们疯狂运行，系统的其余部分应该继续正常工作。