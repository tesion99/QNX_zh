# 线程调度器注意事项

你通常使用线程调度器的目的

- 设计一个系统，使其在满载时，以可预测或可定义的方式工作
- 防止不重要或不受信任的应用独占系统

无论哪种情况，你都需要根据整个系统来配置线程调度器的参数。基本的考虑是

- 你应该创建多少个调度分区，以及每个分区应安装什么软件?
- 每个调度器分区应获得多少保证的CPU百分比?
- 每个调度器分区的关键预算(如果有)应该是多少?
- 时间平均窗口应该是多大? 以毫毛为单位



## 确定调度程序分区的数量及其内容

​	将功能相关的软件放于相同的分区是合理的，通常也是正确的选择。然而，自适应分区线程调度是一种决定何时不运行软件的结构化方式。因此，实际的方法是，如果软件在不同情况下需要CPU时间，则将软件分成不同的调度分区。

Note: 你能创建的最大分区数是32

例如，如果系统是一个数据包路由器，功能如下

- 路由数据包
- 收集并记录数据包路由的统计信息
- 处理对端路由器的路由拓扑协议
- 收集并记录路由拓扑指标

拥有两个调度分区似乎是合理的，一个用于路由，一个用于拓扑。当然记录路由指标在功能上与数据包路由相关。

然而，但系统过载时，这就意味着机器无法完成更多出色的工作，你需要决定什么工作可以缓慢地处理。在这个例子中，当路由器因传入的数据包而过载时，路由这些数据仍然是很重要的。但是你可能会做如此决定，如果你无法完成所有操作，你宁愿路由数据而不是收集路由指标。通过同样的分析，你可能会得出这样的结论：路由拓扑协议应该继续运行，其使用的机器资源比路由本身少的多，但在需要时可以快速运行。

如此分析后需要3个分区：

- 一个分区用于路由数据包，占有很大份额，比如80%
- 一个分区用于拓扑协议，占比15%，但其最大线程优先级应高于数据包路由的优先级
- 一个分区用于记录路由指标和拓扑协议指标

在这种情况下，我们选择分离路由与记录路由指标的功能相关的组件，因为如果我们被迫挨饿某样东西，我们宁愿只挨饿一个。同样，我们选择将两个功能不相关的组件分组，一个记录路由指标，一个记录拓扑指标，因为我们想在相同的环境下让它们挨饿。(挨饿指处于空闲，不被CPU调度)



## 选择每个分区的CPU百分比

