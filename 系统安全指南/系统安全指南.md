# 系统安全指南

### 安全矩阵

下表描述了安全问题与网络攻击以及QNX系统用于消除这些问题的安全特性

| 安全问题/攻击                | 描述                                                         | 解决方法                                                     |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 静态数据保密性               | 防止攻击者在系统不运行的情况下查看、修改或泄露系统上的敏感数据。 | 基于文件的加密(查看文件系统安全相关章节)                     |
| 数据完整性和代码签名         | 允许将系统资产打包在受完整性保护的容器中，该容器可以随时安装在系统上以供访问。 | QNX可信磁盘(查看文件系统安全相关章节) <br/>安全启动          |
| 不受限制地访问系统资源管理器 | 禁止未认证的系统组件访问系统资源管理器通道，或在其连接后限制它们能够请求的操作 | 安全策略<br/>POSIX权限/ACL(查看访问控制相关章节)             |
| 文件系统访问控制             | 限制各种进程访问文件系统对象                                 | POSIX权限/ACL(查看访问控制相关章节)                          |
| 不可信的代码执行             | 禁止攻击者从文件系统运行或加载不可信的二进制程序             | 路径信任                                                     |
| 重定向控制流                 | 禁止攻击者修改执行控制流程                                   | RELRO                                                        |
| 重复攻击                     | 使攻击者更难猜测代码在内存中的加载位置以进行漏洞利用         | 地址空间布局随机化(ASLR)                                     |
| 缓冲区溢出                   | 检测代码以减轻潜在的缓冲区溢出攻击                           | 使用强化函数支持编译代码(查看强化系统函数章节)               |
| 栈溢出                       | 检测代码以减轻潜在的栈溢出攻击                               | 使用堆栈金丝雀技术来编译代码(查看编译器防御章节)             |
| 泄露敏感系统信息             | 禁止攻击者查看系统上其他进程的私有信息                       | 保护/proc文件系统(查看/proc文件系统章节)<br/>安全策略        |
| 以最小权限执行进程           | 配置系统以限制进程权限，从而确保它们的任务以最少的需求权限运行 | 安全策略<br/>进程管理器能力<br/>POSIX权限/ACL(查看权限控制章节) |
| 设备硬件访问内核内存         | 禁止攻击者通过设备访问DMA进而访问任意地址                    | QNX系统内存管理单元管理器                                    |
| 拒绝服务                     | - 禁止关键系统运行时耗尽资源<br/>- 意外流量堵塞网络          | - C库中的资源限制(查看setrlimit())<br/>使用网络监狱将一组进程隔离到特定接口, IP地址, 或者协议 |
| 中间人攻击                   | 防止攻击者拦截网络之间的流量。                               | 使用网络监狱将一组进程隔离到特定接口, IP地址, 或者协议       |
| 网络监听                     | 监控网络敏感数据                                             | 同上                                                         |



### 安全特性概览



### 相关命令用法

#### on - 以非默认方式执行命令

语法

```shell
on [-A ability-spec] 		# 指定特定能力
   [-ad | -ae] 				# 禁用或启用ASLR(地址空间布局随机化)
   [-C cpunum]  			# 指定CPU, 从0开始
   [--critical] 			# 创建关键程序, 如果关键程序死亡, 则系统崩溃
   [-d] 					# 与父进程分离
   [-E] 					# 清空所有环境变量, 包括-e选项指定的
   [-e key=value]			# 设置环境变量
   [-h] 					# 以HELD状态启动命令
   [-L rlimit:cur[:max]] 	# 指定资源限制
   [-p priority[policy]]	# 指定优先级
   [-R runmask] 			# 指定运行时掩码
   [-S path] 				# 指定安全策略文件路径, 默认为/proc/boot/secpol.bin
   [-s] 					# 在新的进程组中生成命令
   [-T type] 				# 指定进程类型
   [-t tty]					# 指定终端
   [-u uid[:gid[,gid,…] | -u user_name]  # 以指定uid, gid的用户身份运行
   [-W nsec[:msec]] 		# 等待设备时间
   [-w device] 				# 指定等待的设备
   [-Xsched_command] 		# 使用指定的命令为外部调度程序启动
   [command [args]]			# 运行的命令及参数
```

示例

```shell
on -T serial_driver_t devc-ser8250
```



#### slay - 通过名称或ID杀死或修改一个进程

语法

```shell
slay [-signal_number] 		 # 发送指定信号
	 [-C cpunum]			 # 指定CPU, 从0开始
	 [-f]					 # 强制在共享ID或进程名的所有进程上执行
	 [-h]					 # 发送SIGSTOP信号
	 [-i]					 # 设置继承掩码
	 [-m name|pid]			 # 限制只按照name或pid进行匹配
	 [-P prio[f|r|o]]		 # 指定优先级及调度策略, f:fifo, r:round-robin, o:other
	 [-p]					 # 打印进程ID
	 [-q]					 # 查询进程信息
	 [-Q]					 # 安静模式
	 [-R runmask]			 # 将CPU亲和性设置为 runmask
	 [-S]					 # 不杀死拥有子进程的进程
	 [-s signal_name]		 # 发送信号
	 [-T tid]				 # 将操作应用到指定的线程
	 [-t ttyname]			 # 匹配进程需拥有指定终端
	 [-u]				     # 发送一个SIGCONT信号
	 [-v]					 # 冗余模式, 显示更多信息
	 process_name|process_id # 进程名或ID
	 
```

Note:  slay命令不支持多个命令参数写一起的情况, 需单独分开

```shell
slay -u -v process
```

示例

```shell
slay -P 20 process
```

